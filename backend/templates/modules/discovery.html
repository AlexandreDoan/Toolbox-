{% extends "base.html" %}
{% block title %}Module Découverte Réseau{% endblock %}
{% block content %}

<h2>🌐 Module Découverte Réseau</h2>
<p class="text-muted">Cartographie complète du réseau - identification des hôtes actifs</p>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for cat, msg in messages %}
      <div class="alert alert-{{ 'danger' if cat == 'error' else cat }} alert-dismissible fade show" role="alert">
        {{ msg }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="card mb-4">
  <div class="card-header">
    <h5>🎯 Configuration de la découverte</h5>
  </div>
  <div class="card-body">
    <form method="post">
      <div class="row mb-3">
        <div class="col-md-8">
          <label for="target" class="form-label">Réseau cible</label>
          <input type="text" class="form-control" name="target" id="target" 
                 placeholder="ex: 192.168.1.0/24, 10.0.0.1-10, dvwa" required>
          <div class="form-text">
            <small>Formats: Plage CIDR (192.168.1.0/24), IP unique (192.168.1.1), hostname (dvwa)</small>
          </div>
        </div>
        <div class="col-md-4">
          <label for="scan_mode" class="form-label">Mode de scan</label>
          <div class="form-control-plaintext">
            <span class="badge bg-primary fs-6">Complet + Agressif</span>
          </div>
          <small class="text-muted">Découverte + Ports + Services + OS</small>
        </div>
      </div>
      
      <div class="d-grid gap-2 d-md-flex">
        <button type="submit" class="btn btn-primary btn-lg">
          🚀 Lancer la découverte asynchrone
        </button>
        <button type="button" class="btn btn-outline-info" onclick="showModuleInfo()">
          📋 Info module
        </button>
        <a href="{{ url_for('tasks.tasks_dashboard') }}" class="btn btn-outline-secondary">
          📊 Monitoring des tâches
        </a>
      </div>
    </form>
  </div>
</div>

<!-- Info du module -->
<div class="collapse" id="moduleInfo">
  <div class="card card-body mb-4">
    <h6>📋 À propos du Module Découverte Réseau :</h6>
    <ul>
      <li><strong>Mission</strong> : Cartographier le réseau et identifier tous les hôtes actifs</li>
      <li><strong>Outils utilisés</strong> : Nmap (discovery scan, port scan, service detection, OS detection)</li>
      <li><strong>Durée typique</strong> : 1-5 minutes selon la taille du réseau</li>
      <li><strong>Mode</strong> : Découverte complète + scan agressif automatique</li>
      <li><strong>Monitoring</strong> : Suivi temps réel via Celery + page dédiée</li>
    </ul>
    
    <div class="alert alert-info">
      <strong>🚀 Nouveau : 100% Asynchrone !</strong><br>
      • Lancement instantané sans attente<br>
      • Monitoring temps réel de la progression<br>
      • Résultats consultables dès la fin<br>
      • Interface non bloquante
    </div>
  </div>
</div>

<script>
function showModuleInfo() {
    const element = document.getElementById('moduleInfo');
    const collapse = new bootstrap.Collapse(element, {
        toggle: true
    });
}
</script>

{% endblock %}
